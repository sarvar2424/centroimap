<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Shafran Group — Payroll Slides (Glass UI RU/UZ)</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'SF Pro Display',sans-serif;background:linear-gradient(135deg,#0f0f0f 0%,#1a1a1a 30%,#2d2d2d 60%,#1a1a1a 100%);color:#fff;overflow-x:hidden;position:relative;-webkit-font-smoothing:antialiased;}
/* Background blobs */
.ios-bg{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;overflow:hidden;}
.blob{position:absolute;border-radius:50%;filter:blur(100px);opacity:.15;animation:float 25s ease-in-out infinite;}
.blob1{width:600px;height:600px;background:radial-gradient(circle,#ffffff,#e0e0e0);top:-150px;left:-150px;animation-delay:0s;}
.blob2{width:500px;height:500px;background:radial-gradient(circle,#d4d4d4,#9e9e9e);bottom:-150px;right:-150px;animation-delay:-12s;}
.blob3{width:550px;height:550px;background:radial-gradient(circle,#f5f5f5,#bdbdbd);top:50%;left:50%;transform:translate(-50%,-50%);animation-delay:-6s;}
@keyframes float{0%,100%{transform:translate(0,0) scale(1);}33%{transform:translate(120px,-100px) scale(1.15);}66%{transform:translate(-100px,120px) scale(0.85);}}
/* Subtle grid */
.glass-grid{position:fixed;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(rgba(255,255,255,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,0.025) 1px,transparent 1px);background-size:60px 60px;z-index:1;pointer-events:none;}
/* Language switcher */
.language-switcher{position:fixed;top:24px;right:36px;z-index:101;display:flex;gap:8px;background:rgba(20,20,20,0.8);backdrop-filter:blur(30px);border-radius:50px;padding:6px;border:1px solid rgba(255,255,255,0.15);box-shadow:0 8px 24px rgba(0,0,0,0.6);}
.lang-btn{padding:8px 20px;border:none;background:transparent;color:rgba(255,255,255,0.6);font-size:14px;font-weight:600;cursor:pointer;border-radius:50px;transition:all .3s cubic-bezier(0.16,1,0.3,1);letter-spacing:.5px;}
.lang-btn:hover{color:rgba(255,255,255,0.9);}
.lang-btn.active{background:rgba(255,255,255,0.15);color:#fff;box-shadow:0 4px 12px rgba(255,255,255,0.1);}
/* Container / slides */
.container{position:relative;z-index:2;scroll-snap-type:y mandatory;overflow-y:scroll;height:100vh;scroll-behavior:smooth;}
.container::-webkit-scrollbar{width:0;}
.slide{min-height:100vh;display:flex;align-items:center;justify-content:center;scroll-snap-align:start;padding:4rem 2rem;position:relative;}
.content{max-width:1200px;width:100%;opacity:0;transform:translateY(40px) scale(0.96);animation:slideIn 1s cubic-bezier(0.16,1,0.3,1) forwards;}
@keyframes slideIn{to{opacity:1;transform:translateY(0) scale(1);}}
/* Glass cards */
.glass-card{background:rgba(255,255,255,0.06);backdrop-filter:blur(50px) saturate(180%);-webkit-backdrop-filter:blur(50px) saturate(180%);border:1px solid rgba(255,255,255,0.15);border-radius:32px;padding:60px;margin-bottom:40px;box-shadow:0 25px 80px rgba(0,0,0,0.4),0 2px 4px rgba(255,255,255,0.1) inset,0 -2px 4px rgba(0,0,0,0.2) inset;transition:all .5s cubic-bezier(0.16,1,0.3,1);position:relative;overflow:hidden;}
.glass-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.4),transparent);}
.glass-card::after{content:'';position:absolute;top:-50%;right:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(255,255,255,0.03) 0%,transparent 70%);animation:shimmer 8s ease-in-out infinite;pointer-events:none;}
@keyframes shimmer{0%,100%{transform:scale(1) rotate(0deg);opacity:.3;}50%{transform:scale(1.3) rotate(180deg);opacity:.6;}}
.glass-card:hover{transform:translateY(-10px) scale(1.01);border-color:rgba(255,255,255,0.25);background:rgba(255,255,255,0.08);box-shadow:0 35px 100px rgba(0,0,0,0.5),0 3px 6px rgba(255,255,255,0.15) inset,0 -3px 6px rgba(0,0,0,0.25) inset;}
/* Titles */
.section-title{font-size:clamp(2.2rem,6vw,4.2rem);font-weight:800;letter-spacing:-.04em;margin-bottom:40px;background:linear-gradient(135deg,#fff 0%,#d0d0d0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;filter:drop-shadow(0 0 30px rgba(255,255,255,0.2));display:flex;align-items:center;gap:20px;animation:fadeInUp .8s ease-out;}
@keyframes fadeInUp{from{opacity:0;transform:translateY(30px);}to{opacity:1;transform:translateY(0);}}
.section-number{display:inline-flex;align-items:center;justify-content:center;width:70px;height:70px;background:linear-gradient(135deg,rgba(255,255,255,0.15) 0%,rgba(255,255,255,0.05) 100%);border:1.5px solid rgba(255,255,255,0.2);border-radius:18px;font-size:28px;font-weight:700;backdrop-filter:blur(20px);box-shadow:0 8px 32px rgba(0,0,0,0.2);transition:all .3s ease;}
.section-number:hover{transform:scale(1.1) rotate(5deg);}
.text{color:rgba(255,255,255,0.75);text-align:justify;margin-bottom:20px;font-size:17px;font-weight:400;line-height:1.8;letter-spacing:-.01em;}
.icon{width:26px;height:26px;opacity:.85;transition:all .3s ease;vertical-align:-4px;}
/* Highlight and budget blocks */
.highlight-box{background:linear-gradient(135deg,rgba(255,255,255,0.12) 0%,rgba(255,255,255,0.06) 100%);backdrop-filter:blur(30px);border:1.5px solid rgba(255,255,255,0.2);border-radius:20px;padding:24px 28px;margin:8px 0 28px 0;font-size:18px;font-weight:500;color:rgba(255,255,255,0.95);box-shadow:0 15px 50px rgba(0,0,0,0.3),inset 0 1px 0 rgba(255,255,255,0.15);display:flex;gap:12px;align-items:center;}
.budget-item{background:rgba(255,255,255,0.04);backdrop-filter:blur(30px);border:1px solid rgba(255,255,255,0.12);border-radius:20px;padding:22px 28px;margin:14px 0;display:flex;justify-content:space-between;align-items:center;transition:all .4s cubic-bezier(0.16,1,0.3,1);position:relative;overflow:hidden;}
.budget-item::before{content:'';position:absolute;left:0;top:0;width:4px;height:100%;background:linear-gradient(180deg,rgba(255,255,255,0.5),rgba(255,255,255,0.1));transform:scaleY(0);transition:transform .3s ease;}
.budget-item:hover::before{transform:scaleY(1);}
.budget-item:hover{background:rgba(255,255,255,0.08);border-color:rgba(255,255,255,0.25);transform:translateX(12px);box-shadow:0 15px 50px rgba(0,0,0,0.3);}
.budget-title{font-weight:600;color:rgba(255,255,255,0.9);font-size:16px;display:flex;align-items:center;gap:12px;letter-spacing:-.01em;}
.budget-amount{font-size:28px;font-weight:800;background:linear-gradient(135deg,#fff 0%,#c0c0c0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:-.02em;}
.total-box{background:linear-gradient(135deg,rgba(255,255,255,0.15) 0%,rgba(255,255,255,0.08) 100%);backdrop-filter:blur(40px);border:2px solid rgba(255,255,255,0.25);border-radius:24px;padding:32px 40px;margin:28px 0;display:flex;justify-content:space-between;align-items:center;box-shadow:0 20px 70px rgba(0,0,0,0.3),inset 0 2px 0 rgba(255,255,255,0.15);transition:all .4s ease;}
.total-box:hover{transform:scale(1.02);background:linear-gradient(135deg,rgba(255,255,255,0.18) 0%,rgba(255,255,255,0.1) 100%);}
.total-label{font-size:18px;font-weight:700;color:rgba(255,255,255,0.95);letter-spacing:-.01em;display:flex;align-items:center;gap:10px;}
.total-amount{font-size:44px;font-weight:800;background:linear-gradient(135deg,#fff 0%,#d0d0d0 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:-.03em;}
/* Dynamic Island & progress ring */
.dynamic-island{position:fixed;top:24px;left:50%;transform:translateX(-50%);padding:10px 24px;background:rgba(20,20,20,0.8);backdrop-filter:blur(30px);border-radius:50px;border:1px solid rgba(255,255,255,0.15);z-index:100;font-size:14px;color:rgba(255,255,255,0.85);font-weight:600;box-shadow:0 8px 24px rgba(0,0,0,0.6);transition:all .3s cubic-bezier(0.16,1,0.3,1);letter-spacing:.5px;}
.dynamic-island:hover{background:rgba(30,30,30,0.9);padding:10px 30px;transform:translateX(-50%) scale(1.05);}
.progress-ring{position:fixed;bottom:36px;right:36px;width:70px;height:70px;z-index:100;}
.progress-ring-circle{transition:stroke-dashoffset .35s;transform:rotate(-90deg);transform-origin:50% 50%;}
.progress-ring-bg{background:rgba(20,20,20,0.6);backdrop-filter:blur(30px);border-radius:50%;width:70px;height:70px;display:flex;align-items:center;justify-content:center;font-size:14px;color:rgba(255,255,255,0.8);font-weight:700;border:1px solid rgba(255,255,255,0.2);box-shadow:0 8px 24px rgba(0,0,0,0.4);transition:all .3s ease;}
.progress-ring-bg:hover{transform:scale(1.1);background:rgba(30,30,30,0.7);}
/* Tables */
.table-wrap{overflow-x:auto;}
.glass-table{width:100%;border-collapse:separate;border-spacing:0 12px;font-size:14px;color:#fff;}
.glass-table thead th{background:rgba(255,255,255,0.1);padding:12px 14px;text-align:left;font-size:12px;text-transform:uppercase;letter-spacing:.06em;color:rgba(255,255,255,0.8);}
.glass-table thead th.left{border-top-left-radius:12px;border-bottom-left-radius:12px;}
.glass-table thead th.right{border-top-right-radius:12px;border-bottom-right-radius:12px;text-align:right;}
.glass-table tbody tr{background:rgba(255,255,255,0.05);}
.glass-table tbody tr td{padding:12px 14px;}
.glass-table tbody tr td.left{border-top-left-radius:12px;border-bottom-left-radius:12px;}
.glass-table tbody tr td.right{text-align:right;border-top-right-radius:12px;border-bottom-right-radius:12px;}
.glass-table tbody tr .muted{opacity:.75;}
.glass-table tbody tr.total{background:rgba(255,255,255,0.10);font-weight:700;}
.glass-table tbody tr.total td{padding:14px;}
/* Responsive */
@media(max-width:768px){
  .slide{padding:3rem 1.5rem;}
  .glass-card{padding:40px 30px;}
  .section-title{font-size:2.4rem;}
  .dynamic-island{font-size:13px;padding:10px 20px;}
  .language-switcher{top:80px;right:20px;}
}
  </style>
</head>
<body>
  <!-- Background -->
  <div class="ios-bg">
    <div class="blob blob1"></div>
    <div class="blob blob2"></div>
    <div class="blob blob3"></div>
  </div>
  <div class="glass-grid"></div>

  <!-- Language Switcher -->
  <div class="language-switcher">
    <button class="lang-btn" data-lang="UZ">O'zbek</button>
    <button class="lang-btn active" data-lang="RU">Русский</button>
  </div>

  <!-- Dynamic Island -->
  <div class="dynamic-island" id="slideIndicator">01 / 07</div>

  <!-- Progress Ring -->
  <div class="progress-ring">
    <div class="progress-ring-bg">
      <svg width="70" height="70" style="position:absolute">
        <circle id="progressCircle" class="progress-ring-circle" stroke="#ffffff" stroke-width="3" fill="transparent" r="31" cx="35" cy="35" />
      </svg>
      <span id="progressText">0%</span>
    </div>
  </div>

  <!-- Slides Container -->
  <div class="container" id="container">
    <div id="slidesRoot"></div>
  </div>

  <script>
/* ===== Icons (inline SVG strings) ===== */
const Icons = {
  Org: '<svg viewBox="0 0 24 24" class="icon" aria-hidden><circle cx="12" cy="5" r="2.4" fill="currentColor" opacity="0.2"/><path d="M12 7.8v4.2m0 0H6m6 0h6" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><circle cx="6" cy="19" r="2.4" fill="currentColor" opacity="0.2"/><circle cx="18" cy="19" r="2.4" fill="currentColor" opacity="0.2"/></svg>',
  Table: '<svg viewBox="0 0 24 24" class="icon" aria-hidden><rect x="3" y="5" width="18" height="14" rx="3" fill="currentColor" opacity="0.12"/><path d="M3 10h18M12 5v14" stroke="currentColor" stroke-width="1.4"/></svg>',
  Money: '<svg viewBox="0 0 24 24" class="icon" aria-hidden><rect x="3" y="6" width="18" height="12" rx="2" fill="currentColor" opacity="0.08"/><circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.4" fill="none"/></svg>',
  Pie: '<svg viewBox="0 0 24 24" class="icon" aria-hidden><circle cx="12" cy="12" r="9" fill="currentColor" opacity="0.12"/><path d="M12 3a9 9 0 0 1 9 9h-9V3z" fill="currentColor"/></svg>'
};

const usd = (n) => "$" + Number(n).toLocaleString('en-US', { maximumFractionDigits: 0 });

/* ===== Data per language ===== */
function buildData(lang) {
  const t = lang === 'RU' ? {
    title: 'Shafran Group — Структура и зарплаты',
    subtitle: 'HQ, курьеры, розница · таблицы и итоги',
    sections: {
      org: { title: '1) Штат и иерархия (сводно)' },
      hq: { title: '2) Центральный офис (HQ) — состав и ставки' },
      cour: { title: '3) Курьерский пул' },
      retail: { title: '4) Розничные команды по точкам' },
      totals: { title: '5) Итого ФОТ (ежемесячно)' },
      opex: { title: '6) Прочие ежемесячные расходы (без COGS/налогов)' },
      grand: { title: '7) Общая модель расходов/мес' }
    },
    table: { role:'Роль', fte:'FTE', rate:'Ставка, $/мес', subtotal:'Субтотал, $/мес', note:'Примечание',
             point:'Точка', people:'Кол-во', wage:'Ставка $', sum:'Сумма $' },
    notes: { covered:'Покрывается владельцем/COO, без отдельной ставки',
             hqSum:'ФОТ HQ по спецификации',
             excl:'*Без закупочной стоимости товара и налогов' },
    labels:{ hqTotal:'Итого HQ', courTotal:'Итого курьеры', retailTotal:'Итого розница',
             payrollTotal:'ИТОГО ФОТ', expenses:'Итого прочие расходы', grandTotal:'ИТОГО (ФОТ + прочие)' },
    ui: { summary: 'Полная сводка по составу, FTE и ежемесячным выплатам.' }
  } : {
    title: 'Shafran Group — Tuzilma va ish haqi',
    subtitle: 'HQ, kuryerlar, chakana · jadvallar va yakunlar',
    sections: {
      org: { title: '1) Shtat va ierarxiya (umumiy)' },
      hq: { title: '2) Markaziy ofis (HQ) — tarkib va stavkalar' },
      cour: { title: '3) Kuryerlar pooli' },
      retail: { title: '4) Chakana jamoalar nuqtalar bo‘yicha' },
      totals: { title: '5) FOT jami (oyiga)' },
      opex: { title: '6) Boshqa oylik xarajatlar (COGS/soliqsiz)' },
      grand: { title: '7) Umumiy xarajat modeli/oy' }
    },
    table: { role:'Rol', fte:'FTE', rate:'Stavka, $/oy', subtotal:'Sub‑jami, $/oy', note:'Izoh',
             point:'Nuqta', people:'Soni', wage:'Stavka $', sum:'Jami $' },
    notes: { covered:"Egası/COO qoplaydi, alohida stavka yo‘q",
             hqSum:"HQ FOT (spetsifikatsiya bo‘yicha)",
             excl:"*Tovar tannarxi (COGS) va soliqlarsiz" },
    labels:{ hqTotal:'HQ jami', courTotal:'Kuryerlar jami', retailTotal:'Chakana jami',
             payrollTotal:'FOT JAMI', expenses:'Boshqa xarajatlar jami', grandTotal:'JAMI (FOT + boshqa)' },
    ui: { summary: "Shtat, FTE va oylik to‘lovlar bo‘yicha to‘liq yig‘indi." }
  };

  const hqRows = [
    { role: 'COO (Операционный директор)', fte: 1, rateText: '$1,500–3,000' },
    { role: 'Area Supervisor', fte: 1, rateText: '$1,000–2,000' },
    { role: 'Wholesale Manager', fte: 0, rateText: '—', note: t.notes.covered },
    { role: 'Procurement Manager', fte: 0, rateText: '—', note: t.notes.covered },
    { role: 'Storekeeper / Кладовщик', fte: 1, rateText: '$500–1,000' },
    { role: 'IT/Мijozlar bazasi (рассылки) + Disp.', fte: 1, rateText: '$1,000–1,500' },
    { role: 'Финансы Controller / Главбух', fte: 1, rateText: '$1,000' },
    { role: 'HR Generalist + Office Admin', fte: 1, rateText: '$600–1,000' },
    { role: 'Head of Marketing', fte: 1, rateText: '$1,500' },
    { role: 'Performance Marketer', fte: 1, rateText: '$1,000' },
    { role: 'SMM Manager', fte: 1, rateText: '$700' },
    { role: 'Retention/Рассылки Manager', fte: 1, rateText: '$800' },
    { role: 'Videographer', fte: 1, rateText: '$900' },
    { role: 'Photographer', fte: 1, rateText: '$800' },
    { role: 'Video Editor / Motion', fte: 1, rateText: '$900' },
    { role: 'Designer', fte: 1, rateText: '$700' },
    { role: 'Copywriter / Community', fte: 1, rateText: '$600' },
  ];

  const hqTotal = 14700;
  const couriers = { fte: 2, rate: 600, total: 1200 };
  const retailRows = [
    { point: 'Shafran C5 — Парфюм', people: 2, wage: 900 },
    { point: 'Shafran C5 — Косметика', people: 2, wage: 700 },
    { point: 'O‘rikzor', people: 3, wage: 900 },
    { point: 'Stylord', people: 2, wage: 900 },
  ];
  const retailTotal = retailRows.reduce((s,r)=>s+r.people*r.wage,0);

  const otherExpenses = [
    { name: lang==='RU'?'Аренда+коммунальные (точки)':'Ijara+kommunal (nuqtalar)', amount: 7700 },
    { name: lang==='RU'?'Уборка':'Tozalash', amount: 300 },
    { name: 'Media (Meta/Google/Telegram)', amount: 7000 },
    { name: lang==='RU'?'Инфлюенсеры':'Influencerlar', amount: 3000 },
    { name: lang==='RU'?'HQ офис (оценка)':'HQ ofis (taxmin)', amount: 1500 },
    { name: lang==='RU'?'ПО/сервисы':'Dastur/servislar', amount: 500 },
  ];
  const otherTotal = otherExpenses.reduce((s,e)=>s+e.amount,0);
  const payrollTotal = hqTotal + couriers.total + retailTotal;
  const grandTotal = payrollTotal + otherTotal;

  return { t,hqRows,hqTotal,couriers,retailRows,retailTotal,otherExpenses,otherTotal,payrollTotal,grandTotal };
}

/* ===== Slides builder (returns HTML string) ===== */
function buildSlidesHTML(data, lang) {
  const slides = [
    {
      title: data.t.title,
      subtitle: data.t.subtitle,
      body: `
        <div class="highlight-box">${Icons.Org}<span>${data.t.ui.summary}</span></div>
        <div class="budget-item"><div class="budget-title">${Icons.Money}${lang==='RU'?'ФОТ HQ':'HQ FOT'}</div><div class="budget-amount">${usd(data.hqTotal)}</div></div>
        <div class="budget-item"><div class="budget-title">${Icons.Money}${lang==='RU'?'ФОТ розницы':'Chakana FOT'}</div><div class="budget-amount">${usd(data.retailTotal)}</div></div>
        <div class="budget-item"><div class="budget-title">${Icons.Money}${lang==='RU'?'Курьеры':'Kuryerlar'}</div><div class="budget-amount">${usd(data.couriers.total)}</div></div>
      `
    },
    {
      title: data.t.sections.hq.title,
      body: `
        <div class="table-wrap">
          <table class="glass-table">
            <thead>
              <tr>
                <th class="left">${data.t.table.role}</th>
                <th>${data.t.table.fte}</th>
                <th>${data.t.table.rate}</th>
                <th>${data.t.table.note}</th>
                <th class="right">${data.t.table.subtotal}</th>
              </tr>
            </thead>
            <tbody>
              ${data.hqRows.map(r => `
                <tr>
                  <td class="left">${r.role}</td>
                  <td>${r.fte}</td>
                  <td>${r.rateText}</td>
                  <td class="muted">${r.note || '—'}</td>
                  <td class="right">—</td>
                </tr>
              `).join('')}
              <tr class="total">
                <td class="left" colspan="4">${data.t.notes.hqSum}</td>
                <td class="right">${usd(data.hqTotal)}</td>
              </tr>
            </tbody>
          </table>
        </div>
      `
    },
    {
      title: data.t.sections.cour.title,
      body: `
        <div class="budget-item"><div class="budget-title">${Icons.Table}FTE</div><div class="budget-amount">${data.couriers.fte}</div></div>
        <div class="budget-item"><div class="budget-title">${Icons.Money}${data.t.table.rate}</div><div class="budget-amount">${usd(data.couriers.rate)}</div></div>
        <div class="budget-item"><div class="budget-title">${Icons.Money}${lang==='RU'?'Сумма':'Jami'}</div><div class="budget-amount">${usd(data.couriers.total)}</div></div>
      `
    },
    {
      title: data.t.sections.retail.title,
      body: `
        <div class="table-wrap">
          <table class="glass-table">
            <thead>
              <tr>
                <th class="left">${data.t.table.point}</th>
                <th>${data.t.table.people}</th>
                <th>${data.t.table.wage}</th>
                <th class="right">${data.t.table.sum}</th>
              </tr>
            </thead>
            <tbody>
              ${data.retailRows.map(r => `
                <tr>
                  <td class="left">${r.point}</td>
                  <td>${r.people}</td>
                  <td>${usd(r.wage)}</td>
                  <td class="right">${usd(r.people*r.wage)}</td>
                </tr>
              `).join('')}
              <tr class="total">
                <td class="left" colspan="3">${lang==='RU'?'Итого розница':'Chakana jami'}</td>
                <td class="right">${usd(data.retailTotal)}</td>
              </tr>
            </tbody>
          </table>
        </div>
      `
    },
    {
      title: data.t.sections.totals.title,
      body: `
        <div class="budget-item"><div class="budget-title">${Icons.Money}${data.t.labels.hqTotal}</div><div class="budget-amount">${usd(data.hqTotal)}</div></div>
        <div class="budget-item"><div class="budget-title">${Icons.Money}${data.t.labels.retailTotal}</div><div class="budget-amount">${usd(data.retailTotal)}</div></div>
        <div class="budget-item"><div class="budget-title">${Icons.Money}${data.t.labels.courTotal}</div><div class="budget-amount">${usd(data.couriers.total)}</div></div>
        <div class="total-box"><div class="total-label">${Icons.Money}${data.t.labels.payrollTotal}</div><div class="total-amount">${usd(data.payrollTotal)}</div></div>
      `
    },
    {
      title: data.t.sections.opex.title,
      body: `
        <div class="table-wrap">
          <table class="glass-table">
            <thead>
              <tr>
                <th class="left">${lang==='RU'?'Статья':'Modda'}</th>
                <th class="right">${lang==='RU'?'Сумма, $/мес':'Miqdor, $/oy'}</th>
              </tr>
            </thead>
            <tbody>
              ${data.otherExpenses.map(e => `
                <tr>
                  <td class="left">${e.name}</td>
                  <td class="right">${usd(e.amount)}</td>
                </tr>
              `).join('')}
              <tr class="total">
                <td class="left">${data.t.labels.expenses}</td>
                <td class="right">${usd(data.otherTotal)}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <p class="text" style="font-size:13px;margin-top:8px;opacity:.7">${data.t.notes.excl}</p>
      `
    },
    {
      title: data.t.sections.grand.title,
      body: `
        <div class="budget-item"><div class="budget-title">${Icons.Money}${data.t.labels.payrollTotal}</div><div class="budget-amount">${usd(data.payrollTotal)}</div></div>
        <div class="budget-item"><div class="budget-title">${Icons.Pie}${data.t.labels.expenses}</div><div class="budget-amount">${usd(data.otherTotal)}</div></div>
        <div class="total-box"><div class="total-label">${Icons.Money}${data.t.labels.grandTotal}</div><div class="total-amount">${usd(data.grandTotal)}</div></div>
      `
    }
  ];

  return slides.map((s, idx) => `
    <section class="slide">
      <div class="content">
        <div class="glass-card">
          <div class="section-title">
            <span class="section-number">${String(idx+1).padStart(2,'0')}</span>
            <span>${s.title}</span>
          </div>
          ${s.subtitle ? `<div class="text" style="margin-bottom:18px">${s.subtitle}</div>` : ''}
          ${s.body}
        </div>
      </div>
    </section>
  `).join('');
}

/* ===== Render / interactions ===== */
const container = document.getElementById('container');
const slidesRoot = document.getElementById('slidesRoot');
const progressCircle = document.getElementById('progressCircle');
const progressText = document.getElementById('progressText');
const slideIndicator = document.getElementById('slideIndicator');
const circumference = 2 * Math.PI * 31;
progressCircle.style.strokeDasharray = circumference;
progressCircle.style.strokeDashoffset = circumference;

const langButtons = document.querySelectorAll('.lang-btn');
let lang = localStorage.getItem('preferredLanguage') || 'RU';

function setActiveLangButton() {
  langButtons.forEach(btn => {
    const bLang = btn.getAttribute('data-lang');
    btn.classList.toggle('active', bLang === lang);
  });
}

function renderSlides() {
  const data = buildData(lang);
  slidesRoot.innerHTML = buildSlidesHTML(data, lang);
  container.scrollTop = 0;
  updateIndicators();
  observeReveal();
}

function updateIndicators() {
  const pct = (container.scrollTop / (container.scrollHeight - container.clientHeight)) * 100;
  const off = circumference - (pct/100) * circumference;
  progressCircle.style.strokeDashoffset = off;
  progressText.textContent = isFinite(pct) ? Math.round(pct) + '%' : '0%';
  const slides = container.querySelectorAll('.slide');
  let cur = 1;
  slides.forEach((s, i) => {
    if (s.offsetTop - 20 <= container.scrollTop) cur = i + 1;
  });
  slideIndicator.textContent = String(cur).padStart(2,'0') + ' / ' + String(slides.length).padStart(2,'0');
}

function observeReveal() {
  const options = { threshold: 0.15, root: container, rootMargin: '0px 0px -80px 0px' };
  const observer = new IntersectionObserver((entries)=>{
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const t = entry.target;
        t.style.opacity = '1';
        t.style.transform = 'translateY(0) scale(1)';
      }
    });
  }, options);
  container.querySelectorAll('.content').forEach(c => observer.observe(c));
}

container.addEventListener('scroll', () => {
  updateIndicators();
  // Parallax blobs
  const scrolled = container.scrollTop;
  document.querySelectorAll('.blob').forEach((blob, index) => {
    const speed = (index + 1) * 0.1;
    blob.style.transform = 'translateY(' + (scrolled * speed) + 'px)';
  });
});

// Language switching
langButtons.forEach(button => {
  button.addEventListener('click', () => {
    lang = button.getAttribute('data-lang') || 'RU';
    localStorage.setItem('preferredLanguage', lang);
    setActiveLangButton();
    renderSlides();
  });
});

// Initial render
setActiveLangButton();
renderSlides();
  </script>
</body>
</html>
